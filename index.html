<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø¸Ù…ÙŠ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ Ø§Ù„Ø®Ø§Øµ ğŸ§ª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #0288d1; --bg: #f1f8fe; --card-bg: #ffffff; }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg); margin: 0; padding-bottom: 50px; }
        header { background: var(--primary); color: white; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .container { max-width: 800px; margin: auto; padding: 15px; }
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-right: 5px solid var(--primary); }
        .user-section { background: #fff; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center; border: 2px solid #bbdefb; }
        input[type="text"] { width: 90%; padding: 12px; border-radius: 8px; border: 2px solid #ddd; text-align: center; font-size: 1.1rem; margin: 10px 0; outline: none; }
        input[type="text"]:focus { border-color: var(--primary); }
        #editor { display: none; }
        textarea { width: 100%; border: 1px solid #ddd; border-radius: 8px; padding: 10px; box-sizing: border-box; font-family: 'Cairo'; font-size: 1rem; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-save { background: #2e7d32; width: 100%; margin-top: 15px; font-size: 1.1rem; }
        .info-box { text-align: right; background: #fffef2; padding: 15px; border-radius: 8px; border: 1px solid #ffe082; margin-bottom: 15px; font-size: 0.9rem; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ““ Ø¯ÙØªØ±ÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ø§Ù„Ø®Ø§Øµ</h1>
    <p id="user-display">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¯ÙˆÙŠÙ† Ø§Ù„Ø¢Ù…Ù†</p>
</header>

<div id="home-page" class="container">
    <div class="user-section" id="login-box">
        <h3 style="color: var(--primary);">ğŸ” Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØµÙˆÙ„Ùƒ Ø§Ù„Ø®Ø§Øµ</h3>
        
        <div class="info-box">
            <p><strong>âš ï¸ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†:</strong></p>
            <ul style="padding-right: 20px;">
                <li>Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù‡Ùˆ Ù…ÙØªØ§Ø­Ùƒ Ù„Ø±Ø¤ÙŠØ© Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ.</li>
                <li><strong>ØªØ¬Ù†Ø¨</strong> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© (Ø§Ø³Ù…ÙƒØŒ ØªÙ„ÙŠÙÙˆÙ†Ùƒ).</li>
                <li><strong>Ø§Ø³ØªØ®Ø¯Ù…</strong> Ø±Ù…Ø²Ø§Ù‹ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹ (Ù…Ø«Ø§Ù„: <span style="color:red">Zq#99x</span>).</li>
                <li>Ø§Ø­ÙØ¸ Ø§Ù„Ø±Ù…Ø² Ø¬ÙŠØ¯Ø§Ù‹Ø› ÙØ¨Ø¯ÙˆÙ†Ù‡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.</li>
            </ul>
        </div>

        <input type="text" id="user-key" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø²Ùƒ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù‡Ù†Ø§...">
        <button class="btn" onclick="setUser()">ÙØªØ­ Ø¯ÙØªØ±ÙŠ Ø§Ù„Ø®Ø§Øµ</button>
    </div>

    <div id="subjects-list" style="display:none;">
        <div id="grid"></div>
        <button class="btn" onclick="logout()" style="background:#78909c; margin-top:25px; width:100%">ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù…Ø² (ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬) ğŸ”„</button>
    </div>
</div>

<div id="editor" class="container">
    <button onclick="goHome()" class="btn" style="background:#607d8b; padding: 8px 15px;">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <h2 id="edit-title" style="text-align:center; color:var(--primary); margin: 20px 0;"></h2>
    
    <div class="card"><h3>ğŸ“ Ù…Ù„Ø®ØµÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</h3><textarea id="in-summary" rows="5"></textarea></div>
    <div class="card"><h3>âœ… Ù…Ù‡Ø§Ù…ÙŠ ÙˆÙˆØ§Ø¬Ø¨Ø§ØªÙŠ</h3><textarea id="in-tasks" rows="3"></textarea></div>
    <div class="card"><h3>ğŸ’¡ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h3><textarea id="in-alerts" rows="2"></textarea></div>
    <div class="card"><h3>ğŸ”— Ø±ÙˆØ§Ø¨Ø· ÙˆÙ…ØµØ§Ø¯Ø±</h3><textarea id="in-links" rows="2"></textarea></div>

    <button class="btn btn-save" id="save-btn" onclick="saveToCloud()">Ø­ÙØ¸ ÙÙŠ Ø³Ø­Ø§Ø¨ØªÙŠ Ø§Ù„Ø®Ø§ØµØ© âœ…</button>
</div>

<script>
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¨Ø·
    const SUPABASE_URL = 'https://jxpzssoclvikjqyzbend.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_P0QFRGCOPmqSOvmF_YgWhA_WgTeqZ4u';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const subjects = [
        { name: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©", types: ["Ù†Ø¸Ø±ÙŠ", "Ø¹Ù…Ù„ÙŠ"] },
        { name: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©", types: ["Ù†Ø¸Ø±ÙŠ", "Ø¹Ù…Ù„ÙŠ"] },
        { name: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø­ÙŠØ§ØªÙŠØ©", types: ["Ù†Ø¸Ø±ÙŠ", "Ø¹Ù…Ù„ÙŠ"] },
        { name: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„ØªÙ†Ø§Ø³Ù‚ÙŠØ©", types: ["Ù†Ø¸Ø±ÙŠ", "Ø¹Ù…Ù„ÙŠ"] },
        { name: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©", types: ["Ù†Ø¸Ø±ÙŠ"] },
        { name: "Ù…Ù†Ù‡Ø¬ÙŠØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ", types: ["Ù†Ø¸Ø±ÙŠ"] },
        { name: "ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù†Ø§Ù†Ùˆ", types: ["Ù†Ø¸Ø±ÙŠ"] }
    ];

    let activeID = "";
    let currentUser = localStorage.getItem('my_private_key') || "";

    function checkUser() {
        if (currentUser) {
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('subjects-list').style.display = 'block';
            document.getElementById('user-display').innerText = `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: [ ${currentUser} ]`;
            render();
        }
    }

    function setUser() {
        const key = document.getElementById('user-key').value.trim();
        if (key.length < 5) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù…Ø² Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù‚ÙˆÙŠ (Ø£ÙƒØ«Ø± Ù…Ù† 5 Ø£Ø­Ø±Ù)");
        
        if (confirm("Ù‡Ù„ Ù‚Ù…Øª Ø¨Ø­ÙØ¸ Ø§Ù„Ø±Ù…Ø²ØŸ Ù„Ù† ØªØ³ØªØ·ÙŠØ¹ ÙØªØ­ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø¨Ø¯ÙˆÙ†Ù‡.")) {
            localStorage.setItem('my_private_key', key);
            currentUser = key;
            checkUser();
        }
    }

    function logout() {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ ØªØ£ÙƒØ¯ Ù…Ù† Ø­ÙØ¸ Ø±Ù…Ø²Ùƒ Ù„ØªØ¹ÙˆØ¯ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.")) {
            localStorage.removeItem('my_private_key');
            location.reload();
        }
    }

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = subjects.map(s => `
            <div class="card">
                <h3 style="margin:0; color:#333;">${s.name}</h3>
                <div style="display:flex; gap:10px; margin-top:10px">
                    ${s.types.map(t => `<button class="btn" style="flex:1" onclick="openEditor('${s.name}','${t}')">${t}</button>`).join('')}
                </div>
            </div>`).join('');
    }

    async function openEditor(sub, type) {
        activeID = `${sub}-${type}`;
        // Ø¯Ù…Ø¬ Ø§Ù„Ø±Ù…Ø² Ù…Ø¹ Ø§Ù„Ù…Ø§Ø¯Ø© Ù„Ø®Ù„Ù‚ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ø§ ÙŠØªÙƒØ±Ø±
        const combinedKey = `${currentUser}_${activeID}`;

        document.getElementById('home-page').style.display = 'none';
        document.getElementById('editor').style.display = 'block';
        document.getElementById('edit-title').innerText = activeID;
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…Ø¯Ù…Ø¬
        const { data } = await _supabase.from('study_data')
            .select('content')
            .eq('subject_id', combinedKey)
            .maybeSingle();
        
        if (data && data.content) {
            const c = data.content;
            document.getElementById('in-summary').value = c.summary || "";
            document.getElementById('in-tasks').value = c.tasks || "";
            document.getElementById('in-alerts').value = c.alerts || "";
            document.getElementById('in-links').value = c.links || "";
        } else {
            document.querySelectorAll('textarea').forEach(t => t.value = "");
        }
    }

    async function saveToCloud() {
        const btn = document.getElementById('save-btn');
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø´Ø®ØµÙŠ...";
        
        const combinedKey = `${currentUser}_${activeID}`;
        const payload = {
            summary: document.getElementById('in-summary').value,
            tasks: document.getElementById('in-tasks').value,
            alerts: document.getElementById('in-alerts').value,
            links: document.getElementById('in-links').value
        };

        const { error } = await _supabase.from('study_data').upsert({ 
            subject_id: combinedKey, 
            content: payload 
        }, { onConflict: 'subject_id' });
        
        if (error) {
            alert("Ø®Ø·Ø£: " + error.message);
            btn.innerText = "âŒ ÙØ´Ù„";
        } else {
            btn.innerText = "ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø¯ÙØªØ±Ùƒ âœ…";
        }
        setTimeout(() => btn.innerText = "Ø­ÙØ¸ ÙÙŠ Ø¯ÙØªØ±ÙŠ Ø§Ù„Ø®Ø§Øµ âœ…", 2000);
    }

    function goHome() { 
        document.getElementById('home-page').style.display = 'block'; 
        document.getElementById('editor').style.display = 'none'; 
    }

    checkUser();
</script>
</body>
</html>
