<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø¸Ù… Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø±Ù‚Ù…ÙŠ ğŸ§ª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #0288d1; --bg: #f1f8fe; --card-bg: #ffffff; }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg); margin: 0; padding-bottom: 50px; }
        header { background: var(--primary); color: white; padding: 25px; text-align: center; border-radius: 0 0 25px 25px; }
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .subject-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .card { background: var(--card-bg); border-radius: 15px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-right: 6px solid var(--primary); }
        .btn-opt { background: #e1f5fe; color: #01579b; padding: 10px; border-radius: 10px; cursor: pointer; border: none; font-weight: bold; flex: 1; margin: 5px; }
        #editor { display: none; }
        .section-box { background: white; padding: 18px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #e0e0e0; }
        h3 { margin-top: 0; color: var(--primary); font-size: 1rem; }
        textarea { width: 100%; border: 1px solid #cfd8dc; border-radius: 10px; padding: 12px; font-family: 'Cairo'; box-sizing: border-box; resize: vertical; }
        .btn-save { background: #43a047; color: white; padding: 15px; border-radius: 12px; cursor: pointer; border: none; width: 100%; font-size: 1.1rem; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <h1>Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ ğŸ§ª</h1>
    <p>Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© | ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ù…Ù‡Ø§Ù…</p>
</header>

<div id="home-page" class="container">
    <div class="subject-grid" id="grid"></div>
</div>

<div id="editor" class="container">
    <button onclick="goHome()" style="background:#78909c; color:white; padding:8px 20px; border-radius:8px; border:none; cursor:pointer; margin-bottom:15px; font-family:'Cairo';">ğŸ  Ø±Ø¬ÙˆØ¹</button>
    <h2 id="edit-title" style="color:var(--primary); text-align:center;"></h2>
    
    <div class="section-box"><h3>ğŸ“ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</h3><textarea id="in-summary" rows="4"></textarea></div>
    <div class="section-box"><h3>âœ… Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h3><textarea id="in-tasks" rows="3"></textarea></div>
    <div class="section-box"><h3>ğŸ’¡ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3><textarea id="in-alerts" rows="2"></textarea></div>
    <div class="section-box"><h3>ğŸ”— Ø±ÙˆØ§Ø¨Ø· Ù…Ù‡Ù…Ø©</h3><textarea id="in-links" rows="2"></textarea></div>

    <button class="btn-save" id="save-btn" onclick="saveToCloud()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹ âœ…</button>
</div>

<script>
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
    const SUPABASE_URL = 'https://jxpzssoclvikjqyzbend.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_P0QFRGCOPmqSOvmF_YgWhA_WgTeqZ4u';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const subjects = [
        { name: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©", types: ["Ù†Ø¸Ø±ÙŠ", "Ø¹Ù…Ù„ÙŠ"] },
        { name: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©", types: ["Ù†Ø¸Ø±ÙŠ", "Ø¹Ù…Ù„ÙŠ"] },
        { name: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø­ÙŠØ§ØªÙŠØ©", types: ["Ù†Ø¸Ø±ÙŠ", "Ø¹Ù…Ù„ÙŠ"] },
        { name: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„ØªÙ†Ø§Ø³Ù‚ÙŠØ©", types: ["Ù†Ø¸Ø±ÙŠ", "Ø¹Ù…Ù„ÙŠ"] },
        { name: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©", types: ["Ù†Ø¸Ø±ÙŠ"] },
        { name: "Ù…Ù†Ù‡Ø¬ÙŠØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ", types: ["Ù†Ø¸Ø±ÙŠ"] },
        { name: "ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù†Ø§Ù†Ùˆ", types: ["Ù†Ø¸Ø±ÙŠ"] }
    ];

    let activeID = "";

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = subjects.map(s => `
            <div class="card">
                <h3>${s.name}</h3>
                <div style="display:flex; flex-wrap:wrap;">${s.types.map(t => `<button class="btn-opt" onclick="openEditor('${s.name}','${t}')">${t}</button>`).join('')}</div>
            </div>`).join('');
    }

    async function openEditor(sub, type) {
        activeID = `${sub}-${type}`;
        document.getElementById('home-page').style.display = 'none';
        document.getElementById('editor').style.display = 'block';
        document.getElementById('edit-title').innerText = activeID;
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©
        const { data } = await _supabase.from('study_data').select('content').eq('subject_id', activeID).maybeSingle();
        
        if (data && data.content) {
            const c = data.content;
            document.getElementById('in-summary').value = c.summary || "";
            document.getElementById('in-tasks').value = c.tasks || "";
            document.getElementById('in-alerts').value = c.alerts || "";
            document.getElementById('in-links').value = c.links || "";
        } else {
            document.querySelectorAll('textarea').forEach(t => t.value = "");
        }
        window.scrollTo(0,0);
    }

    async function saveToCloud() {
        const btn = document.getElementById('save-btn');
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
        
        const payload = {
            summary: document.getElementById('in-summary').value,
            tasks: document.getElementById('in-tasks').value,
            alerts: document.getElementById('in-alerts').value,
            links: document.getElementById('in-links').value
        };

        const { error } = await _supabase
            .from('study_data')
            .upsert({ subject_id: activeID, content: payload }, { onConflict: 'subject_id' });
        
        if (error) {
            alert("ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: " + error.message);
            btn.innerText = "âŒ ÙØ´Ù„";
        } else {
            btn.innerText = "ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…";
        }
        
        setTimeout(() => btn.innerText = "Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹ âœ…", 2000);
    }

    function goHome() { 
        document.getElementById('home-page').style.display = 'block'; 
        document.getElementById('editor').style.display = 'none'; 
    }

    render();
</script>
</body>
</html>
